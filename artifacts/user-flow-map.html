<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Parallax User Flow & Page Architecture</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #0f0b08 0%, #1a1410 100%);
      color: #c9b9a3;
      padding: 40px 20px;
      line-height: 1.6;
    }
    
    .container {
      max-width: 1400px;
      margin: 0 auto;
    }
    
    h1 {
      color: #ebe1d4;
      margin-bottom: 10px;
      font-size: 2.5em;
      text-align: center;
    }
    
    .subtitle {
      text-align: center;
      color: #a89582;
      margin-bottom: 40px;
      font-size: 0.95em;
    }
    
    .section {
      background: #1a1410;
      border: 1px solid #3a2e22;
      border-radius: 8px;
      padding: 30px;
      margin-bottom: 30px;
    }
    
    h2 {
      color: #d4a040;
      margin-bottom: 20px;
      font-size: 1.6em;
      border-bottom: 2px solid #3a2e22;
      padding-bottom: 10px;
    }
    
    h3 {
      color: #c9b9a3;
      margin: 20px 0 15px 0;
      font-size: 1.1em;
    }
    
    /* Page Map */
    .page-map {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 20px;
      margin-bottom: 20px;
    }
    
    .page-card {
      background: #261e16;
      border: 2px solid #3a2e22;
      border-radius: 6px;
      padding: 20px;
      transition: all 0.3s ease;
    }
    
    .page-card:hover {
      border-color: #d4a040;
      box-shadow: 0 0 15px rgba(212, 160, 64, 0.2);
    }
    
    .page-card.public {
      border-left: 4px solid #6aab8e;
    }
    
    .page-card.protected {
      border-left: 4px solid #c45c3c;
    }
    
    .page-title {
      color: #ebe1d4;
      font-weight: bold;
      margin-bottom: 8px;
      font-size: 1.1em;
      font-family: 'Courier New', monospace;
    }
    
    .page-path {
      color: #8a7a66;
      font-size: 0.85em;
      margin-bottom: 12px;
      font-family: 'Courier New', monospace;
    }
    
    .page-desc {
      color: #a89582;
      font-size: 0.9em;
      margin-bottom: 12px;
    }
    
    .page-actions {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
    }
    
    .action-tag {
      background: rgba(106, 171, 142, 0.15);
      color: #6aab8e;
      padding: 4px 8px;
      border-radius: 3px;
      font-size: 0.8em;
      font-family: 'Courier New', monospace;
    }
    
    .action-tag.redirect {
      background: rgba(196, 92, 60, 0.15);
      color: #c45c3c;
    }
    
    /* Flow Diagram */
    .flow-diagram {
      background: #261e16;
      border: 1px solid #3a2e22;
      border-radius: 6px;
      padding: 25px;
      margin-bottom: 20px;
      font-family: 'Courier New', monospace;
      font-size: 0.9em;
      overflow-x: auto;
    }
    
    .flow-step {
      display: inline-flex;
      align-items: center;
      gap: 10px;
      margin-right: 10px;
      white-space: nowrap;
    }
    
    .flow-box {
      background: #3a2e22;
      border: 1px solid #8a7a66;
      padding: 8px 12px;
      border-radius: 4px;
      color: #ebe1d4;
    }
    
    .flow-box.decision {
      background: #8a7a66;
      color: #1a1410;
      font-weight: bold;
    }
    
    .flow-arrow {
      color: #d4a040;
      font-weight: bold;
    }
    
    /* Auth Table */
    table {
      width: 100%;
      border-collapse: collapse;
      margin: 20px 0;
    }
    
    th {
      background: #261e16;
      color: #d4a040;
      padding: 12px;
      text-align: left;
      border: 1px solid #3a2e22;
      font-family: 'Courier New', monospace;
      font-size: 0.9em;
    }
    
    td {
      padding: 12px;
      border: 1px solid #3a2e22;
      color: #a89582;
    }
    
    tr:nth-child(even) {
      background: #261e16;
    }
    
    /* Navigation List */
    .nav-list {
      list-style: none;
      margin: 15px 0;
    }
    
    .nav-list li {
      padding: 10px 0;
      padding-left: 20px;
      position: relative;
      color: #a89582;
    }
    
    .nav-list li:before {
      content: "→";
      position: absolute;
      left: 0;
      color: #d4a040;
    }
    
    .nav-list li code {
      background: #261e16;
      padding: 2px 6px;
      border-radius: 3px;
      color: #c9b9a3;
      font-family: 'Courier New', monospace;
      font-size: 0.9em;
    }
    
    /* Header Architecture */
    .header-diagram {
      background: #261e16;
      border: 1px solid #3a2e22;
      border-radius: 6px;
      padding: 20px;
      margin: 20px 0;
      font-size: 0.9em;
    }
    
    .header-layout {
      display: grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap: 15px;
      margin: 15px 0;
      background: #1a1410;
      padding: 15px;
      border-radius: 4px;
      border: 1px solid #3a2e22;
    }
    
    .header-section {
      text-align: center;
      padding: 10px;
      background: #261e16;
      border-radius: 4px;
    }
    
    .header-section-title {
      color: #d4a040;
      font-weight: bold;
      margin-bottom: 8px;
      font-family: 'Courier New', monospace;
      font-size: 0.85em;
    }
    
    .header-content {
      color: #a89582;
    }
    
    /* Auth Flow */
    .auth-flow {
      background: #261e16;
      border-left: 4px solid #c45c3c;
      padding: 15px;
      margin: 15px 0;
      border-radius: 4px;
    }
    
    .auth-flow strong {
      color: #c45c3c;
    }
    
    .highlight {
      background: rgba(212, 160, 64, 0.15);
      padding: 2px 6px;
      border-radius: 3px;
      color: #d4a040;
    }
    
    /* Footer */
    footer {
      text-align: center;
      color: #7a6c58;
      margin-top: 60px;
      padding-top: 20px;
      border-top: 1px solid #3a2e22;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Parallax User Flow & Architecture</h1>
    <p class="subtitle">Complete page structure, navigation flows, and authentication system</p>
    
    <!-- Page Map Section -->
    <div class="section">
      <h2>Page Structure (5 Routes)</h2>
      
      <div class="page-map">
        <div class="page-card public">
          <div class="page-title">/</div>
          <div class="page-path">Landing Page</div>
          <div class="page-desc">Entry point for all users. Multi-section narration interface with mode selection and session joining.</div>
          <div class="page-actions">
            <span class="action-tag">Public</span>
            <span class="action-tag">No Auth</span>
            <span class="action-tag">Animated</span>
          </div>
        </div>
        
        <div class="page-card public">
          <div class="page-title">/auth</div>
          <div class="page-path">Authentication</div>
          <div class="page-desc">Sign up or sign in form. Creates user profile on sign up. Redirects to /interview after auth.</div>
          <div class="page-actions">
            <span class="action-tag">Public</span>
            <span class="action-tag redirect">Redirects to /interview</span>
          </div>
        </div>
        
        <div class="page-card protected">
          <div class="page-title">/interview</div>
          <div class="page-path">Behavioral Interview (4 Phases)</div>
          <div class="page-desc">Extracts 9+ behavioral signals. Shows "Profile Complete" screen with exit options: View Profile or Start Session.</div>
          <div class="page-actions">
            <span class="action-tag redirect">Protected</span>
            <span class="action-tag">Requires Auth</span>
          </div>
        </div>
        
        <div class="page-card protected">
          <div class="page-title">/profile</div>
          <div class="page-path">Intelligence Profile</div>
          <div class="page-desc">Displays user's behavioral signals and confidence scores. Actions: Retake Interview, Start Session.</div>
          <div class="page-actions">
            <span class="action-tag redirect">Protected</span>
            <span class="action-tag">Display Name</span>
          </div>
        </div>
        
        <div class="page-card public">
          <div class="page-title">/session/[code]</div>
          <div class="page-path">Session View</div>
          <div class="page-desc">Main conflict resolution session (in-person or remote). Dynamic code = 6-char room code. Allows anonymous join.</div>
          <div class="page-actions">
            <span class="action-tag">Public</span>
            <span class="action-tag">Dynamic</span>
            <span class="action-tag">No Auth</span>
          </div>
        </div>
      </div>
    </div>
    
    <!-- User Navigation Flows -->
    <div class="section">
      <h2>User Navigation Flows</h2>
      
      <h3>Flow 1: First-Time User (Sign Up + Interview)</h3>
      <div class="flow-diagram">
        <div class="flow-step">
          <span class="flow-box">/</span>
          <span class="flow-arrow">→</span>
          <span class="flow-box decision">Auth</span>
          <span class="flow-arrow">→</span>
          <span class="flow-box">/auth</span>
          <span class="flow-arrow">→</span>
          <span class="flow-box decision">Sign Up</span>
          <span class="flow-arrow">→</span>
          <span class="flow-box">/interview</span>
        </div>
        <div style="margin-top: 10px;">
          <span class="flow-arrow">→</span>
          <span class="flow-box decision">Complete</span>
          <span class="flow-arrow">→</span>
          <span class="flow-box">/profile</span> or <span class="flow-box">/</span>
        </div>
      </div>
      
      <h3>Flow 2: Returning User (Sign In + Session)</h3>
      <div class="flow-diagram">
        <div class="flow-step">
          <span class="flow-box">/auth</span>
          <span class="flow-arrow">→</span>
          <span class="flow-box decision">Sign In</span>
          <span class="flow-arrow">→</span>
          <span class="flow-box">/</span>
          <span class="flow-arrow">→</span>
          <span class="flow-box decision">Mode</span>
          <span class="flow-arrow">→</span>
          <span class="flow-box decision">Context</span>
          <span class="flow-arrow">→</span>
          <span class="flow-box">/session/[CODE]</span>
        </div>
      </div>
      
      <h3>Flow 3: Join Existing Session (Anonymous)</h3>
      <div class="flow-diagram">
        <div class="flow-step">
          <span class="flow-box">/</span>
          <span class="flow-arrow">→</span>
          <span class="flow-box decision">Enter Code</span>
          <span class="flow-arrow">→</span>
          <span class="flow-box">/session/[CODE]</span>
        </div>
      </div>
      
      <h3>Flow 4: From Profile to Session</h3>
      <div class="flow-diagram">
        <div class="flow-step">
          <span class="flow-box">/profile</span>
          <span class="flow-arrow">→</span>
          <span class="flow-box decision">Start Session</span>
          <span class="flow-arrow">→</span>
          <span class="flow-box">/</span>
          <span class="flow-arrow">→</span>
          <span class="flow-box decision">Mode + Context</span>
          <span class="flow-arrow">→</span>
          <span class="flow-box">/session/[CODE]</span>
        </div>
      </div>
    </div>
    
    <!-- Authentication & Redirects -->
    <div class="section">
      <h2>Authentication & Access Control</h2>
      
      <h3>Protected Pages (Require Auth)</h3>
      <ul class="nav-list">
        <li><code>/interview</code> — Redirects to <code>/auth</code> if not logged in</li>
        <li><code>/profile</code> — Redirects to <code>/auth</code> if not logged in</li>
      </ul>
      
      <h3>Public Pages (No Auth Required)</h3>
      <ul class="nav-list">
        <li><code>/</code> — Landing page (works for all users)</li>
        <li><code>/auth</code> — Sign up/sign in form</li>
        <li><code>/session/[code]</code> — Session view (allows anonymous join)</li>
      </ul>
      
      <h3>Auth Flow Implementation</h3>
      <div class="auth-flow">
        <strong>useAuth Hook</strong> (<code>src/hooks/useAuth.ts</code>)
        <ul class="nav-list" style="margin-top: 10px;">
          <li>Checks Supabase auth state on component mount</li>
          <li>Sets <code>user</code> and <code>loading</code> state</li>
          <li>No middleware — client-side redirect in page components</li>
          <li>Each protected page manually checks auth state</li>
        </ul>
      </div>
      
      <div class="auth-flow">
        <strong>Auth Functions</strong> (<code>src/lib/auth.ts</code>)
        <ul class="nav-list" style="margin-top: 10px;">
          <li><code>signUp(email, password, displayName)</code> — Creates user + profile row</li>
          <li><code>signIn(email, password)</code> — Authenticates user</li>
          <li><code>signOut()</code> — Logs out user</li>
          <li><code>getUser()</code> — Returns current auth user</li>
        </ul>
      </div>
    </div>
    
    <!-- Header & Global Navigation -->
    <div class="section">
      <h2>Header & Global Navigation</h2>
      
      <h3>Root Layout Architecture</h3>
      <p>File: <code>src/app/layout.tsx</code></p>
      
      <div class="header-diagram">
        <p style="margin-bottom: 15px; color: #d4a040;">Header Structure (Inside LayoutShell)</p>
        <div class="header-layout">
          <div class="header-section">
            <div class="header-section-title">Left</div>
            <div class="header-content">Parallax logo<br><span style="font-size: 0.85em;">(bitcount font, accent color)</span></div>
          </div>
          <div class="header-section">
            <div class="header-section-title">Center</div>
            <div class="header-content">Listen button<br><span style="font-size: 0.85em;">(visible when narration complete)</span></div>
          </div>
          <div class="header-section">
            <div class="header-section-title">Right</div>
            <div class="header-content">Theme toggle<br><span style="font-size: 0.85em;">(light/dark mode)</span></div>
          </div>
        </div>
        
        <p style="margin-top: 15px; color: #a89582; font-size: 0.9em;"><strong>Visibility Logic:</strong> Header hidden (opacity: 0) during landing page narration phases (idle, narrating, chat). Fully visible otherwise.</p>
      </div>
      
      <h3>Listen Button</h3>
      <ul class="nav-list">
        <li>Only visible when <code>narration.phase === "complete"</code></li>
        <li>Replays landing page narration via custom event</li>
        <li>Uses <span class="highlight">liquid-glass</span> styling for effect</li>
      </ul>
    </div>
    
    <!-- Session Creation -->
    <div class="section">
      <h2>Session Creation & Navigation</h2>
      
      <h3>Session Creation Flow</h3>
      <ol style="margin: 15px 0; margin-left: 20px; color: #a89582;">
        <li>User on <code>/</code> clicks "In-Person" or "Remote" mode card</li>
        <li><code>handleModeSelect()</code> sets <code>pendingMode</code></li>
        <li>Shows <code>ContextModePicker</code> overlay (Work, Family, Romantic, etc.)</li>
        <li><code>handleContextSelect()</code> calls <code>POST /api/sessions</code></li>
        <li>API returns <code>{ room_code: "ABC123" }</code></li>
        <li><code>router.push(`/session/ABC123`)</code> navigates to session</li>
      </ol>
      
      <h3>Session Join Flow</h3>
      <ol style="margin: 15px 0; margin-left: 20px; color: #a89582;">
        <li>User enters 6-char code in join input</li>
        <li><code>handleJoin()</code> validates code with <code>isValidRoomCode()</code></li>
        <li><code>router.push(`/session/CODE`)</code> navigates</li>
        <li><code>SessionView</code> loads existing session from database</li>
      </ol>
      
      <h3>Key Navigation Component: TheDoor</h3>
      <div class="auth-flow">
        File: <code>src/components/landing/TheDoor.tsx</code>
        <ul class="nav-list">
          <li>Renders on landing page</li>
          <li>Handles mode selection, context selection, session creation, join</li>
          <li>Shows two ModeCards: "In-Person" and "Remote"</li>
          <li>Shows join code input for existing sessions</li>
          <li>Shows "Talk to Parallax" button (optional explorer)</li>
        </ul>
      </div>
    </div>
    
    <!-- After Authentication -->
    <div class="section">
      <h2>Key Entry Points After Authentication</h2>
      
      <h3>After Sign Up/Sign In</h3>
      <p style="color: #a89582; margin-bottom: 15px;">Auth page sends user to <code>/interview</code> (4-phase interview)</p>
      <div class="auth-flow">
        <strong>Interview Complete Screen</strong> shows two buttons:
        <ul class="nav-list">
          <li><code>View Profile</code> → <code>/profile</code></li>
          <li><code>Start Session</code> → <code>/</code> (back to landing)</li>
        </ul>
      </div>
      
      <h3>From Profile Page</h3>
      <div class="auth-flow">
        Buttons on <code>/profile</code>:
        <ul class="nav-list">
          <li><code>Start Session</code> → <code>/</code> (landing)</li>
          <li><code>Retake Interview</code> → <code>/interview</code></li>
        </ul>
      </div>
      
      <h3>Session Lifecycle</h3>
      <ul class="nav-list">
        <li>User can access <code>/session/[code]</code> from landing or via room code</li>
        <li>No explicit auth required for session join (anonymous support)</li>
        <li>Session data stored in Supabase with Realtime subscriptions</li>
        <li>After session ends: no documented redirect (likely stays in session view or returns to landing)</li>
      </ul>
    </div>
    
    <!-- Access Control Table -->
    <div class="section">
      <h2>Page Access Control Matrix</h2>
      
      <table>
        <thead>
          <tr>
            <th>Page</th>
            <th>Auth Required</th>
            <th>Public Access</th>
            <th>Entry Point</th>
            <th>Next Steps</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><code>/</code></td>
            <td>No</td>
            <td>Yes</td>
            <td>Direct URL, default</td>
            <td><code>/auth</code>, <code>/interview</code>, <code>/session/[code]</code></td>
          </tr>
          <tr>
            <td><code>/auth</code></td>
            <td>No</td>
            <td>Yes</td>
            <td>Direct URL, redirect from protected</td>
            <td><code>/interview</code></td>
          </tr>
          <tr>
            <td><code>/interview</code></td>
            <td>Yes</td>
            <td>No</td>
            <td>After auth, from <code>/profile</code></td>
            <td><code>/</code>, <code>/profile</code></td>
          </tr>
          <tr>
            <td><code>/profile</code></td>
            <td>Yes</td>
            <td>No</td>
            <td>From <code>/interview</code>, clicked in profile</td>
            <td><code>/</code>, <code>/interview</code></td>
          </tr>
          <tr>
            <td><code>/session/[code]</code></td>
            <td>No</td>
            <td>Yes</td>
            <td>Mode selection on <code>/</code>, join code</td>
            <td>(within session, summary)</td>
          </tr>
        </tbody>
      </table>
    </div>
    
    <!-- Behavioral Signals -->
    <div class="section">
      <h2>Behavioral Signal Extraction</h2>
      
      <h3>4-Phase Interview Structure</h3>
      <p style="color: #a89582; margin-bottom: 15px;">Completed at <code>/interview</code> page. Extracts 9+ signal types:</p>
      
      <ol style="margin-left: 20px; color: #a89582;">
        <li><span class="highlight">Attachment Style</span> — Secure, Anxious, Avoidant, Fearful</li>
        <li><span class="highlight">Conflict Mode</span> — Thomas-Kilmann: Competing, Collaborating, Compromising, etc.</li>
        <li><span class="highlight">Emotional Regulation</span> — Gottman patterns, flooding onset, repair capacity</li>
        <li><span class="highlight">Values & Needs</span> — Core values extraction, motivation patterns</li>
      </ol>
      
      <h3>Database Schema</h3>
      <ul class="nav-list">
        <li><strong>user_profiles</strong> — user_id, display_name, interview_completed</li>
        <li><strong>behavioral_signals</strong> — user_id, signal_type, signal_value (JSON), confidence</li>
        <li>Each signal stored with confidence score (0-1)</li>
        <li>Linked to Supabase Auth users</li>
      </ul>
    </div>
    
    <footer>
      <p>Parallax Architecture Map — Created for Claude Code Hackathon (Feb 2026)</p>
      <p style="margin-top: 10px; font-size: 0.9em;">Built by Eddie Belaval / id8Labs — Powered by Claude Opus 4.6</p>
    </footer>
  </div>
</body>
</html>
